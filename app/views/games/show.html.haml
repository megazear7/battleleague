.row
  .btn-group
    - if current_user.games.include? @game
      = link_to "New Army", new_army_path, class: "btn btn-default"
    - else
      = link_to "Join Game", new_army_path, class: "btn btn-default", notice: "Create an army to join the game"
    = link_to "New Alliance", new_alliance_path, class: "btn btn-default"
.row
  .col-md-6
    %h2= @game.name
    %p
      %b Description:
      %br
      =  @game.description
      %br
      %br
    %p
      %b Objective:
      %br
      =  @game.objective
      %br
      %br
    %p
      %b Other Details:
      %br
      =  @game.details

    %hr
    %table.table.table-hover.table-responsive
      %tr
        %th Name
        %th
        %th Player
        %th Army Type
        %th Point Cost
        %th Turn Count
        %th Alliance
      - @game.armies.order('turn_count DESC').each do |army|
        %tr
          - if army.user == current_user
            %td= link_to army.name, army
            - if army == @game.current_army and army.turn_count != 0 and (army.x_cord and army.y_cord)
              %td 
                = simple_form_for army do |f|
                  = f.hidden_field :x_cord, value: army.x_cord
                  = f.hidden_field :y_cord, value: army.y_cord
                  = f.submit "Skip Move", class: "skip"
            - elsif not (army.x_cord and army.y_cord)
              %td= link_to "Place Army", edit_army_path(army)
            - else
              %td
            %td  You
            %td= army.army_type
            %td= army.point_cost
            - if army == @game.current_army and not army.turn_count == 0
              %td.my-next-turn 
                = army.turn_count
                &nbsp;(Next Move)
            - elsif army.turn_count == 0
              %td= link_to "Needs Placed", edit_army_path(army)
            - else
              %td= army.turn_count
            - if army.alliance
              %td
                = army.alliance.name
                = link_to "Leave", army_path(army, alliance_id: 0), method: :put
            - else
              %td
                Not Allied -
                = link_to "Ally", army_form_alliance_path(army)
          - else
            %td= army.name
            %td
            %td= army.user.name
            %td= army.army_type
            %td= army.point_cost
            - if army == @game.current_army
              %td.enemy-next-turn 
                = army.turn_count
                &nbsp;(Next Move)
            - elsif army.turn_count == 0
              %td Not Placed
            - else
              %td= army.turn_count
            - if army.alliance
              %td= army.alliance.name
            - else
              %td No Alliance
    %p.left-margin * Remember that you might not be close enough to see some enemy armies!
  .col-md-6
    = render partial: "maps/map", locals: { map: @game.map, is_edit: false }
.container.comment-section
  - @game.comments.each do |c|
    - if c.comment_type == "public" or ( c.comment_type == "team" and c.army.alliance and c.army.alliance == @game.armies.where(user: current_user).first.alliance ) or ( c.comment_type == "whisper" and ( c.user == current_user or c.army.user == current_user ) )
      .row
        %span.comment
          - if c.army.user == current_user
            You said
          - else
            = c.army.user.name + " says"
          - if c.comment_type == "public"
            (public)
          - elsif c.comment_type == "team"
            = "(Message to " + c.army.alliance.name + ")"
          - elsif c.comment_type == "whisper"
            = "(whisper from " + c.army.user.name + ")"
          = c.content
%br
%br
- if @game.armies.where(user: current_user).first
  .row
    = simple_form_for @comment do |f|
      .col-md-4
        = f.input :content, input_html: { class: "string form-control" }
      .col-md-2
        = f.input :comment_type, collection: comment_types(@game, current_user), selected: "Public", input_html: { class: "dropdown form-control" }
      .col-md-2{ id: "whisper" }
        = f.association :user, label: "Whisper To", collection: @game.users, input_html: { class: "dropdown form-control" }
      = f.hidden_field :army_id, value: @game.armies.where(user: current_user).first.id
      .col-md-2
        %br
        = f.submit class: "btn btn-primary shift-down"
- else 
  You must 
  = link_to "join", new_army_path
  the game to comment

%br
%br
.btn-group
  = link_to 'Edit', edit_game_path(@game), class: "btn btn-default"
  = link_to 'Back', games_path, class: "btn btn-default"
  = link_to 'Reset Turn Count', game_set_turns_path(@game), class: "btn btn-default"
%br
%br

.hidden
  - if @game.current_army
    = number_field_tag :current_army_id, @game.current_army.id

.hidden
  .left-move
    = form_tag :action => 'move', :controller => 'armies', :method => :put do |f|
      = hidden_field_tag "army[x_cord]"
      = hidden_field_tag "army[y_cord]"
      = hidden_field_tag "_method", "put"
      = submit_tag "", :style => "display:none"
  .right-move
    = form_tag :action => 'move', :controller => 'armies', :method => :put do |f|
      = hidden_field_tag "army[x_cord]"
      = hidden_field_tag "army[y_cord]"
      = hidden_field_tag "_method", "put"
      = submit_tag "", :style => "display:none"
  .up-move
    = form_tag :action => 'move', :controller => 'armies', :method => :put do |f|
      = hidden_field_tag "army[x_cord]"
      = hidden_field_tag "army[y_cord]"
      = hidden_field_tag "_method", "put"
      = submit_tag "", :style => "display:none"
  .down-move
    = form_tag :action => 'move', :controller => 'armies', :method => :put do |f|
      = hidden_field_tag "army[x_cord]"
      = hidden_field_tag "army[y_cord]"
      = hidden_field_tag "_method", "put"
      = submit_tag "", :style => "display:none"
